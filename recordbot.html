 
<!DOCTYPE html>
<html lang="en">
  <head>

    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="icon" href="../../favicon.ico">
   
    <title>Experiments with HTML5 video and media fragments</title>
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">
     <link href="css/layout.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
        
        
    <script src="js/bootstrap.js"></script>
    <script src="js/jquery-2.1.3.js"></script>
    <script src="js/bootstrap.min.js"></script>
    
    <script src="js/audiodisplay.js"></script>
    <script src="js/recorderjs/recorder.js"></script>
    <script src="js/main.js"></script>
  <script src="js/recordbot.js"></script>
  </head>
  
 <body>

    <div class="site-wrapper">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <div class="masthead clearfix">
            <div class="inner">
              <h3 class="masthead-brand">StoryBot</h3>
              <h4 class="masthead-brand">Bishop Family Archive</h4>
              <nav>
                <ul class="nav masthead-nav">
                  <li class="active"><a href="#">Home</a></li>
                  <li><a href="#">Help</a></li>
                  <li><a href="#">Contact</a></li>
                </ul>
              </nav>
            </div>
          </div>

          <div class="inner cover">

             <div id="main">

      			<video class="v" autobuffer controls>
             		<source src="assets/dad_5min.mov" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'> 
					<source src="assets/dad_5min.ogv" type='video/ogg; codecs="theora, vorbis"'> 
				</video>
            
           
          </div>

			<div id="viz" >
				<div>
				<canvas id="analyser" width="500" height="50"></canvas>
				</div>
				<div>
				<canvas id="wavedisplay" width="500" height="50"></canvas>
				</div>
			</div>
			<div id="controls" >
				<div id="readyState">
					<p id="play">Play Movie and Record Audio</p>
					<div id="triangle" onclick="toggleRecording(this);setRecordingState();">
					</div>	
				</div>
				<div id="recordingState">
					<p id="recording">Recording...</p>
					<div id="recordingCircle" onclick="toggleRecording(this);setSaveState();">
					</div>	
				</div>
				<div id="saveState">
					<p id="save">Save Recording or Start Over?</p>
					<div>
					<a id="save" href="#">
					<img src="assets/save.png" onclick="saveAudio();setSavedState();">
					<a href="#" onclick="setReadyState();">Do Over</a>
					</div>
				</div>
				
				<div id="savedState">
					<p id="save">Saved and Sent!</p>
					<a href="#" onclick="setReadyState();">Record Another Story</a>
				</div>
				
			</div>

      </div>

    </div>

</body>
</html>

<script type="text/javascript">
  // get video element
  var video = document.getElementsByTagName("video")[0];
  
  // get page URL without fragment & time offset
    var currenturl = location.href;
    var pageurl = location.href.split("#")[0];
  var offsettime = retrieveTimeFragment(currenturl);

  // set cut-paste-entry to currenturl as default
    //document.displayurl.offseturl.value = currenturl;

  // once video is loaded, jump to time offset
  video.addEventListener("loadedmetadata", function() {
    // calculate video url & offset
    // jump to offset given in video url
    // START: THIS SHOULD BE NATIVE IN BROWSER
    var videourl = video.currentSrc;
    var videooffset = retrieveTimeFragment(videourl);
    if (videooffset != 0) {
      video.currentTime = videooffset;
    }
    // END: THIS SHOULD BE NATIVE IN BROWSER

    // first time only: jump to offset given in page url
    if (offsettime != 0) {
      video.currentTime = offsettime;
      offsettime = 0;
    }
  }, false);

  // set callback for video to update page URL with time offset when paused
  video.addEventListener("pause", function() {
      videotime = video.currentTime;
      changePageUrlOffset(videotime);
    }, false);

    // when the hash on the window changes, also do an offset
    window.addEventListener("hashchange", function() {
      var url = location.href;
      var time = retrieveTimeFragment(url);
    video.currentTime = time;
    // update cut-and-paste url
      document.displayurl.offseturl.value = location.href;
    }, false);
    
    // jump to time offset action
    function jumpToTimeoffset(form) {
    var time = form.time.value;
      video.currentTime = time;
    changePageUrlOffset(time);
    }
    
    // change the video's url
    function changeVideoUrl(form) {
      var newurl = form.url.value;
      video.src = newurl;
    // possibly the change of a hash on a video's src attribute could be done
    // without having to re-load the file
      video.load();
    var newurloffset = retrieveTimeFragment(newurl);
      changePageUrlOffset(newurloffset);
    }
    
    // parse the time hash out of the given url
    function retrieveTimeFragment(url) {
      var pageoffset = 0;
    var offsettime = 0;
      if (url.split("#")[1] != null) {
      pageoffset = url.split("#")[1];
      if (pageoffset.substring(2) != null) {
        offsettime = pageoffset.substring(2);
      }
    }
    return offsettime;
    }
    
    // change urls
    function changePageUrlOffset(time) {
      // update page url
    location.hash = "#t=" + time;
      // update cut-and-paste url
      document.displayurl.offseturl.value = location.href;
    }
  
</script>

  </body>
</html>